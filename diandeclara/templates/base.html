
{% load static i18n compress%}<!DOCTYPE html>
{% get_current_language as LANGUAGE_CODE %}
<html lang="{{ LANGUAGE_CODE }}">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <title>
      {% block title %}
      dIAndeclara
    {% endblock title %}
  </title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description"
        content="Behold My Awesome Project!" />
  <meta name="author"
        content="Jota,Sady, Jcamilo ColombIA" />
  <link rel="icon" href="{% static 'images/favicons/favicon2.ico' %}" />
  {% block css %}
    <!-- Latest compiled and minified Bootstrap CSS -->
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.2.3/css/bootstrap.min.css"
          integrity="sha512-SbiR/eusphKoMVVXysTKG/7VseWii+Y3FdHrt0EpKgpToZeemhqHeZeLWLhJutz/2ut2Vw1uQEj2MbRF+TVBUA=="
          crossorigin="anonymous"
          referrerpolicy="no-referrer" />
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" 
          href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
<!-- Your stuff: Third-party CSS libraries go here -->
<!-- This file stores project-specific CSS -->


{% compress css %}
  <link href="{% static 'css/project.css' %}" rel="stylesheet" />
{% endcompress %}


{% endblock css %}
<!-- Le javascript
    ================================================== -->
{# Placed at the top of the document so pages load faster with defer #}
{% block javascript %}

<!-- Bootstrap JS Bundle (includes Popper) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" 
        integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" 
        crossorigin="anonymous"></script>

<!-- Global Tooltip Initialization -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Initialize all tooltips globally
  try {
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
      return new bootstrap.Tooltip(tooltipTriggerEl, {
        trigger: 'hover focus',
        placement: 'auto',
        html: true,
        delay: { show: 500, hide: 100 }
      });
    });
    
    // Also initialize popovers if any
    var popoverTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'));
    var popoverList = popoverTriggerList.map(function (popoverTriggerEl) {
      return new bootstrap.Popover(popoverTriggerEl);
    });
    
    console.log('Bootstrap components initialized - Tooltips:', tooltipList.length, 'Popovers:', popoverList.length);
  } catch (error) {
    console.error('Error initializing Bootstrap components:', error);
  }
});
</script>

<!-- Your stuff: Third-party javascript libraries go here -->


<!-- place project specific Javascript in this file -->


{% compress js %}
  <script defer src="{% static 'js/project.js' %}"></script>
{% endcompress %}


{% endblock javascript %}
</head>
<body class="{% block bodyclass %}{% endblock bodyclass %}">
  {% block body %}
  {% comment %} <div class="mb-1">
    <nav class="navbar navbar-expand-md navbar-light bg-light">
      <div class="container-fluid">
        <button class="navbar-toggler navbar-toggler-right"
                type="button"
                data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent"
                aria-controls="navbarSupportedContent"
                aria-expanded="false"
                aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <a class="navbar-brand" href="{% url 'home' %}">dIAndeclara</a>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav mr-auto">
            <li class="nav-item active">
              <a class="nav-link" href="{% url 'home' %}">Home <span class="visually-hidden">(current)</span></a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{% url 'about' %}">About</a>
            </li>
            {% if request.user.is_authenticated %}
              <li class="nav-item">
                <a class="nav-link"
                   href="{% url 'users:detail' request.user.pk %}">{% translate "My Profile" %}</a>
              </li>
              <li class="nav-item">
                {# URL provided by django-allauth/account/urls.py #}
                <a class="nav-link" href="{% url 'account_logout' %}">{% translate "Sign Out" %}</a>
              </li>
            {% else %}
              {% if ACCOUNT_ALLOW_REGISTRATION %}
                <li class="nav-item">
                  {# URL provided by django-allauth/account/urls.py #}
                  <a id="sign-up-link" class="nav-link" href="{% url 'account_signup' %}">{% translate "Sign Up" %}</a>
                </li>
              {% endif %}
              <li class="nav-item">
                {# URL provided by django-allauth/account/urls.py #}
                <a id="log-in-link" class="nav-link" href="{% url 'account_login' %}">{% translate "Sign In" %}</a>
              </li>
            {% endif %}
          </ul>
        </div>
      </div>
    </nav>
  </div> {% endcomment %}
  <div class="container">
    {% if messages %}
      {% for message in messages %}
        <div class="alert alert-dismissible {% if message.tags %}alert-{{ message.tags }}{% endif %}">
          {{ message }}
          <button type="button"
                  class="btn-close"
                  data-bs-dismiss="alert"
                  aria-label="Close"></button>
        </div>
      {% endfor %}
    {% endif %}
    {% block main %}
      {% block content %}
        <p>Use this document as a way to quick start any new project.</p>
      {% endblock content %}
    {% endblock main %}

    <!-- Asistente Virtual Flotante -->
    {% if user.is_authenticated %}
    <div id="virtual-assistant">
      <!-- Botón flotante del asistente -->
      <div id="assistant-btn" class="assistant-floating-btn">
        <img src="{% static 'images/bot.gif' %}" alt="Asistente Virtual" class="bot-image">
        <div class="pulse-ring"></div>
      </div>

      <!-- Modal del asistente -->
      <div id="assistant-modal" class="assistant-modal">
        <div class="assistant-modal-content">
          <div class="assistant-header">
            <h5><i class="bi bi-robot"></i> Asistente Virtual DIAN</h5>
            <button id="close-assistant" class="btn-close"></button>
          </div>
          
          <div class="assistant-body">
            <div id="assistant-options" class="assistant-options">
              <div class="welcome-message">
                <p>¡Hola! Soy tu asistente virtual. ¿En qué puedo ayudarte hoy?</p>
              </div>
              
              <div class="option-buttons">
                <button id="screen-share-btn" class="option-btn">
                  <i class="bi bi-display"></i>
                  <span>Compartir Pantalla</span>
                  <small>Comparte tu pantalla para recibir ayuda visual</small>
                </button>
                
                <button id="chat-btn" class="option-btn">
                  <i class="bi bi-chat-dots"></i>
                  <span>Chat de Texto</span>
                  <small>Haz preguntas por texto</small>
                </button>
                
                <button id="voice-btn" class="option-btn">
                  <i class="bi bi-mic"></i>
                  <span>Asistente de Voz</span>
                  <small>Habla conmigo, te responderé por texto</small>
                </button>
              </div>
            </div>

            <!-- Pantalla de Chat -->
            <div id="chat-interface" class="chat-interface" style="display: none;">
              <div class="chat-messages" id="chat-messages">
                <div class="bot-message">
                  <i class="bi bi-robot"></i>
                  <span>¡Hola! Puedes preguntarme sobre declaraciones de renta, formularios, pagos y más.</span>
                </div>
              </div>
              <div class="chat-input-area">
                <input type="text" id="chat-input" placeholder="Escribe tu pregunta..." class="form-control">
                <button id="send-message" class="btn btn-primary">
                  <i class="bi bi-send"></i>
                </button>
              </div>
              <div class="chat-controls mt-2">
                <button id="toggle-context-click" class="btn btn-outline-primary btn-sm me-2">
                  <i id="context-click-icon" class="bi bi-cursor-fill"></i>
                  <span id="context-click-text">Modo Interactivo: ON</span>
                </button>
                <button id="back-to-options" class="btn btn-secondary btn-sm">Volver al menú</button>
              </div>
            </div>

            <!-- Pantalla de Voz -->
            <div id="voice-interface" class="voice-interface" style="display: none;">
              <div class="voice-status">
                <div id="voice-indicator" class="voice-indicator">
                  <i class="bi bi-mic-mute"></i>
                </div>
                <p id="voice-status-text">Presiona el botón para hablar</p>
              </div>
              <div class="voice-messages" id="voice-messages">
                <div class="bot-message">
                  <i class="bi bi-robot"></i>
                  <span>Presiona el micrófono y habla. Te escucharé y responderé por texto.</span>
                </div>
              </div>
              <div class="voice-controls">
                <button id="start-recording" class="btn btn-primary">
                  <i class="bi bi-mic"></i> Hablar
                </button>
                <button id="stop-recording" class="btn btn-danger" style="display: none;">
                  <i class="bi bi-stop"></i> Detener
                </button>
              </div>
              <button id="back-to-options-voice" class="btn btn-secondary btn-sm mt-2">Volver al menú</button>
            </div>

            <!-- Pantalla de Compartir Pantalla -->
            <div id="screen-share-interface" class="screen-share-interface" style="display: none;">
              <div class="screen-share-status">
                <i class="bi bi-display"></i>
                <h6>Compartir Pantalla</h6>
                <p id="screen-status-text">Comparte tu pantalla para recibir ayuda visual personalizada</p>
              </div>
              <div class="screen-share-controls">
                <button id="start-screen-share" class="btn btn-success">
                  <i class="bi bi-camera-video"></i> Iniciar Captura
                </button>
                <button id="stop-screen-share" class="btn btn-danger" style="display: none;">
                  <i class="bi bi-camera-video-off"></i> Detener Captura
                </button>
              </div>
              <div id="screen-preview" class="screen-preview" style="display: none;">
                <video id="screen-video" autoplay muted></video>
              </div>
              
              <!-- Chat integrado para compartir pantalla -->
              <div id="screen-chat" class="screen-chat" style="display: none;">
                <div class="screen-chat-header">
                  <i class="bi bi-eye-fill text-success me-2"></i>
                  <span class="text-success fw-bold">Viendo tu pantalla</span>
                </div>
                <div class="screen-chat-messages" id="screen-chat-messages">
                  <div class="bot-message">
                    <i class="bi bi-robot"></i>
                    <span>¡Perfecto! Ya puedo ver tu pantalla. Puedes hacerme preguntas sobre lo que estás viendo y te ayudaré basándome en el contenido.</span>
                  </div>
                </div>
                <div class="screen-chat-input-area">
                  <input type="text" id="screen-chat-input" placeholder="Pregúntame sobre lo que ves en pantalla..." class="form-control">
                  <button id="send-screen-message" class="btn btn-primary">
                    <i class="bi bi-send"></i>
                  </button>
                </div>
              </div>
              
              <button id="back-to-options-screen" class="btn btn-secondary btn-sm mt-2">Volver al menú</button>
            </div>
          </div>
        </div>
      </div>
    </div>
    {% endif %}

  </div>
  {% endblock body %}
  <!-- /container -->
  
  {% block modal %}
  {% endblock modal %}
  {% block inline_javascript %}
    {% comment %}
    Script tags with only code, no src (defer by default). To run
    with a "defer" so that you run inline code:
    <script>
      window.addEventListener('DOMContentLoaded', () => {
        /* Run whatever you want */
      });
    </script>
    {% endcomment %}
  {% endblock inline_javascript %}
</body>
</html>
